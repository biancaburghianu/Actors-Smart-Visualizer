<html>

<head>
  <title>Login</title>
  <link rel="stylesheet" type="text/css" href="login.css" />
</head>

<body>
  <div class="container">
    <div class="card">
      <div class="inner-box" id="card">
        <div class="card-front">
          <h2>Login</h2>
          <p>Actors Smart Visualizer</p>
          <p>
            Un site destinat previzualizarii statisticilor in urma
            norminalizarilor la Screen Actors Guild Awards.
          </p>
          <form action="" method="post">
            <input type="username" class="input-box" id="username" placeholder="Your username" required />
            <input type="password" class="input-box" id="password" placeholder="Your password" required />
            <button type="submit">Login</button>
          </form>
          <input type="button" class="submit-btn" value="Create an account"
            onClick="window.location.href='http://localhost:3456/register'" />
        </div>
        <a href="">Forgot password</a>
      </div>
    </div>
    <script>
      const form = document.querySelector("form");

      form.addEventListener("submit", (event) => {
        event.preventDefault();

        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        const xhr = new XMLHttpRequest();
        const url = "http://localhost:3456/login";
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            if (xhr.status === 200) {
              const authHeader = xhr.getResponseHeader("Authorization");
              if (authHeader) {
                const token = authHeader.split(" ")[1];
                console.log(token);
                localStorage.setItem("token", token);
                window.location.href = "http://localhost:3456/home";
              }
            } else if (xhr.status === 401) {
              alert("Username sau parola gresite!");
            }
          }
        }
        const data = JSON.stringify({ username, password });
        xhr.send(data);
      });
    </script>



</body>

</html>